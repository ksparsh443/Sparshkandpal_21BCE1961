<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess-Like Game</title>
    <link href="https://fonts.googleapis.com/css2?family=Tilt+Warp&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        body {
            background-color: rgb(255, 255, 255);
            display: grid;
            place-items: center;
            font-family: 'Tilt Warp', cursive;
        }

        h1 {
            margin: 50px 0;
            font-size: 5rem;
            color: rgb(32, 183, 93);
            -webkit-text-stroke: 0.5px black;
        }

        input {
            margin-bottom: 20px;
            padding: 5px;
            font-size: 1.2rem;
        }

        button {
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        img {
            width: 30px;
        }

        #cont {
            display: grid;
            grid-template-columns: repeat(5, 1fr); /* 5 columns */
            grid-template-rows: repeat(5, 1fr); /* 5 rows */
            gap: 2px; /* Adding gap between buttons */
        }

        .btn {
            font-size: 2rem;
            width: 100px;
            height: 100px;
            cursor: pointer;
            margin: 0;
            background-color: rgb(206, 203, 203);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: black;
        }

        #find {
            font-size: 1.5rem;
            color: white;
            cursor: pointer;
            padding: 7px;
            border-radius: 10px;
            width: 250px;
            background-color: rgb(0, 0, 0);
        }

        .btn:hover {
            background-color: rgb(226, 228, 230);
        }

        button.enabled {
            opacity: 1;
        }

        p {
            font-size: 2rem;
        }

        /* Added styling for player pieces */
        .pawn {
            color: rgb(0, 0, 0); /* Pawn color */
        }

        .hero1 {
            color: rgb(32, 183, 93); /* Hero1 color */
        }

        .hero2 {
            color: rgb(255, 0, 0); /* Hero2 color */
        }

        #chess-board {
            display: grid;
            grid-template-columns: repeat(5, 100px);
            grid-template-rows: repeat(5, 100px);
            gap: 2px;
        }

        .square {
            width: 100px;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgb(206, 203, 203);
            border-radius: 10px;
            font-size: 2rem;
            cursor: pointer;
        }

        .square:hover {
            background-color: rgb(226, 228, 230);
        }
    </style>
</head>

<body>
    <h1>Chess-Like Game</h1>

    <div style="display: flex; width: 95vw; position: relative;">
        <p id="userCont">You : <span id="user"></span></p>
        <p style="position: absolute; right: 0;" id="oppNameCont">Opponent : <span id="oppName"></span></p>
    </div>
    <br>
    <p id="valueCont">You are playing as <span id="value"></span></p>
    <br>
    <p id="whosTurn">Player 1's Turn</p>
    <div>
        <p style="font-size: 1.2rem;" id="enterName">Enter your name:</p>
        <input type="text" placeholder="Name" id="name" autocomplete="off">
    </div>
    <button id="find">Search for a player</button>
    <img id="loading" src="loading.gif" alt="Loading">

    <div id="bigcont">
        <div id="chess-board">
            <!-- Add 25 squares here -->
            <div class="square" id="sq1" draggable="true">
                <div class="chess-piece">
                    <i class="black">A-p1</i> <!-- Pawn 1 -->
                </div>
            </div>
            <div class="square" id="sq2" draggable="true">
                <div class="chess-piece">
                    <i class="white">A-p2</i> <!-- Pawn 2 -->
                </div>
            </div>
            <div class="square" id="sq3" draggable="true">
                <div class="chess-piece">
                    <i class="white">A-h1</i> <!-- Hero 1 -->
                </div>
            </div>
            <div class="square" id="sq4" draggable="true">
                <div class="chess-piece">
                    <i class="white">A-h3</i> <!-- Pawn 3 -->
                </div>
            </div>
            <div class="square" id="sq5" draggable="true">
                <div class="chess-piece">
                    <i class="white">A-h2</i> <!-- Pawn 4 -->
                </div>
            </div>
            
            <div class="square" id="sq6"></div>
            <div class="square" id="sq7"></div>
            <div class="square" id="sq8"></div>
            <div class="square" id="sq9"></div>
            <div class="square" id="sq10"></div>
            <div class="square" id="sq11"></div>
            <div class="square" id="sq12"></div>
            <div class="square" id="sq13"></div>
            <div class="square" id="sq14"></div>
            <div class="square" id="sq15"></div>
            <div class="square" id="sq16"></div>
            <div class="square" id="sq17"></div>
            <div class="square" id="sq18"></div>
            <div class="square" id="sq19"></div>
            <div class="square" id="sq20"></div>
            <div class="square" id="sq21" draggable="true">
                <div class="chess-piece">
                    <i class="black">B-p1</i> <!-- Pawn 5 -->
                </div>
            </div>
            <div class="square" id="sq22" draggable="true">
                <div class="chess-piece">
                    <i class="black">B-p2</i> <!-- Pawn 6 -->
                </div>
            </div>
            <div class="square" id="sq23" draggable="true">
                <div class="chess-piece">
                    <i class="black">B-h1</i> <!-- Hero 2 -->
                </div>
            </div>
            <div class="square" id="sq24" draggable="true">
                <div class="chess-piece">
                    <i class="black">B-h2</i> <!-- Pawn 7 -->
                </div>
            </div>
            <div class="square" id="sq25" draggable="true">
                <div class="chess-piece">
                    <i class="black">B-h3</i> <!-- Pawn 8 -->
                </div>
            </div>
            
        </div>
    </div>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        document.getElementById("loading").style.display = "none";
        document.getElementById("bigcont").style.display = "none";
        document.getElementById("userCont").style.display = "none";
        document.getElementById("oppNameCont").style.display = "none";
        document.getElementById("valueCont").style.display = "none";
        document.getElementById("whosTurn").style.display = "none";

        const socket = io();

        let name;

        document.getElementById('find').addEventListener("click", function () {
            name = document.getElementById("name").value;
            document.getElementById("user").innerText = name;
            if (!name) {
                alert("Please enter a name");
            } else {
                socket.emit("find", { name: name });

                document.getElementById("loading").style.display = "block";
                document.getElementById("find").disabled = true;
            }
        });

        socket.on("find", (e) => {
            let allPlayersArray = e.allPlayers;
            console.log("html", allPlayersArray);

            if (name) {
                document.getElementById("userCont").style.display = "block";
                document.getElementById("oppNameCont").style.display = "block";
                document.getElementById("valueCont").style.display = "block";
                document.getElementById("loading").style.display = "none";
                document.getElementById("name").style.display = "none";
                document.getElementById("find").style.display = "none";
                document.getElementById("enterName").style.display = "none";
                document.getElementById("bigcont").style.display = "block";
                document.getElementById("whosTurn").style.display = "block";
                document.getElementById("whosTurn").innerText = "Player 1's Turn";
            }

            let oppName;
            let value;

            const foundObject = allPlayersArray.find(obj => obj.p1.p1name === name || obj.p2.p2name === name);
            oppName = foundObject.p1.p1name === name ? foundObject.p2.p2name : foundObject.p1.p1name;
            value = foundObject.p1.p1name === name ? foundObject.p1.p1value : foundObject.p2.p2value;

            document.getElementById("oppName").innerText = oppName;
            document.getElementById("value").innerText = value;
        });

        document.querySelectorAll(".square").forEach(e => {
            e.addEventListener("click", function () {
                // Handle square click
                const squareId = this.id;
                console.log(`Square clicked: ${squareId}`);
            });
        });

        let currentPlayer = 'player1'; // Track whose turn it is

    document.addEventListener('DOMContentLoaded', () => {
        const squares = document.querySelectorAll('.square');
        let selectedPiece = null;

        squares.forEach(square => {
            square.addEventListener('click', () => {
                if (selectedPiece) {
                    // Handle movement
                    movePiece(square);
                } else {
                    // Select piece
                    selectPiece(square);
                }
            });
        });

        function selectPiece(square) {
            if (square.querySelector('.chess-piece i')) {
                // Remove any previous selection
                document.querySelectorAll('.square.selected').forEach(sq => sq.classList.remove('selected'));
                
                // Highlight selected square
                square.classList.add('selected');
                selectedPiece = square.querySelector('.chess-piece i');
            }
        }

        function movePiece(targetSquare) {
            if (targetSquare.classList.contains('selected') && selectedPiece) {
                // Move the piece to the target square
                targetSquare.appendChild(selectedPiece.parentNode);

                // Clear the selection
                document.querySelectorAll('.square.selected').forEach(sq => sq.classList.remove('selected'));
                selectedPiece = null;

                // Switch player turn
                currentPlayer = (currentPlayer === 'player1') ? 'player2' : 'player1';
                console.log(`It's ${currentPlayer}'s turn.`);
            }
        }
      

    });
    </script>
</body>

</html>
